<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËΩ¨ÁõòÊäΩÂ•ñÊ∏∏Êàè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .content {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .wheel-section {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px 0;
        }

        #wheelCanvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff4757;
            z-index: 10;
            filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.3));
        }

        .center-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%);
            border: 5px solid white;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .center-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .center-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: translate(-50%, -50%);
        }

        .config-section {
            flex: 1;
            min-width: 300px;
        }

        .config-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .prize-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }

        .prize-item label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        .prize-item input[type="text"],
        .prize-item input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .prize-item input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
        }

        .remove-btn:hover {
            background: #ff6b81;
        }

        .add-prize-btn,
        .apply-config-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .add-prize-btn {
            background: #667eea;
            color: white;
        }

        .add-prize-btn:hover {
            background: #764ba2;
        }

        .apply-config-btn {
            background: #2ecc71;
            color: white;
        }

        .apply-config-btn:hover {
            background: #27ae60;
        }

        .duration-config {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .duration-config label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .duration-config input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .result-display {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            color: #856404;
            min-height: 60px;
            display: none;
        }

        .result-display.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-row input[type="text"] {
            flex: 2;
        }

        .input-row input[type="number"] {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ ËΩ¨ÁõòÊäΩÂ•ñÊ∏∏Êàè</h1>

        <div class="content">
            <div class="wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="wheelCanvas" width="600" height="600"></canvas>
                    <button class="center-button" id="startBtn">ÂºÄÂßã<br>ÊäΩÂ•ñ</button>
                </div>
                <div class="result-display" id="result"></div>
            </div>

            <div class="config-section">
                <h2 class="config-title">ÈÖçÁΩÆÈù¢Êùø</h2>

                <div class="duration-config">
                    <label>ÊóãËΩ¨Êó∂ÈïøÔºàÁßíÔºâ:</label>
                    <input type="number" id="duration" value="5" min="1" max="10" step="0.5">
                </div>

                <div id="prizesContainer"></div>

                <button class="add-prize-btn" id="addPrizeBtn">+ Ê∑ªÂä†Â•ñÂìÅ</button>
                <button class="apply-config-btn" id="applyConfigBtn">Â∫îÁî®ÈÖçÁΩÆ</button>
            </div>
        </div>
    </div>

    <script>
        class LotteryWheel {
            constructor() {
                this.canvas = document.getElementById('wheelCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.startBtn = document.getElementById('startBtn');
                this.resultDisplay = document.getElementById('result');
                this.duration = 5000; // ÈªòËÆ§5Áßí
                this.isSpinning = false;

                // ÈªòËÆ§Â•ñÂìÅÈÖçÁΩÆ
                this.prizes = [
                    { name: '‰∏ÄÁ≠âÂ•ñ', probability: 10, color: '#FF6B6B' },
                    { name: '‰∫åÁ≠âÂ•ñ', probability: 20, color: '#4ECDC4' },
                    { name: '‰∏âÁ≠âÂ•ñ', probability: 30, color: '#45B7D1' },
                    { name: 'Ë∞¢Ë∞¢ÂèÇ‰∏é', probability: 40, color: '#FFA07A' }
                ];

                this.init();
            }

            init() {
                this.renderConfig();
                this.drawWheel();
                this.bindEvents();
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.spin());
                document.getElementById('addPrizeBtn').addEventListener('click', () => this.addPrize());
                document.getElementById('applyConfigBtn').addEventListener('click', () => this.applyConfig());
            }

            renderConfig() {
                const container = document.getElementById('prizesContainer');
                container.innerHTML = '';

                this.prizes.forEach((prize, index) => {
                    const prizeDiv = document.createElement('div');
                    prizeDiv.className = 'prize-item';
                    prizeDiv.innerHTML = `
                        <label>Â•ñÂìÅ ${index + 1}</label>
                        <div class="input-row">
                            <input type="text" class="prize-name" value="${prize.name}" placeholder="Â•ñÂìÅÂêçÁß∞">
                            <input type="number" class="prize-prob" value="${prize.probability}" min="1" max="100" placeholder="Ê¶ÇÁéá">
                            <input type="color" class="prize-color" value="${prize.color}">
                        </div>
                        ${this.prizes.length > 1 ? `<button class="remove-btn" onclick="lotteryWheel.removePrize(${index})">Âà†Èô§</button>` : ''}
                    `;
                    container.appendChild(prizeDiv);
                });
            }

            addPrize() {
                this.prizes.push({
                    name: 'Êñ∞Â•ñÂìÅ',
                    probability: 10,
                    color: '#' + Math.floor(Math.random()*16777215).toString(16)
                });
                this.renderConfig();
            }

            removePrize(index) {
                if (this.prizes.length > 1) {
                    this.prizes.splice(index, 1);
                    this.renderConfig();
                }
            }

            applyConfig() {
                // ËØªÂèñÈÖçÁΩÆ
                const prizeItems = document.querySelectorAll('.prize-item');
                const newPrizes = [];

                prizeItems.forEach((item, index) => {
                    const name = item.querySelector('.prize-name').value;
                    const probability = parseFloat(item.querySelector('.prize-prob').value);
                    const color = item.querySelector('.prize-color').value;

                    if (name && probability > 0) {
                        newPrizes.push({ name, probability, color });
                    }
                });

                if (newPrizes.length === 0) {
                    alert('Ëá≥Â∞ëÈúÄË¶Å‰∏Ä‰∏™Â•ñÂìÅÔºÅ');
                    return;
                }

                this.prizes = newPrizes;
                this.duration = parseFloat(document.getElementById('duration').value) * 1000;

                this.drawWheel();
                this.resultDisplay.classList.remove('show');
                this.resultDisplay.textContent = '';

                alert('ÈÖçÁΩÆÂ∑≤Â∫îÁî®ÔºÅ');
            }

            drawWheel() {
                const canvas = this.canvas;
                const ctx = this.ctx;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = canvas.width / 2 - 10;

                // Ê∏ÖÁ©∫ÁîªÂ∏É
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ËÆ°ÁÆóÊÄªÊ¶ÇÁéá
                const totalProb = this.prizes.reduce((sum, prize) => sum + prize.probability, 0);

                let startAngle = -Math.PI / 2; // ‰ªéÈ°∂ÈÉ®ÂºÄÂßã

                this.prizes.forEach((prize, index) => {
                    const angle = (prize.probability / totalProb) * 2 * Math.PI;
                    const endAngle = startAngle + angle;

                    // ÁªòÂà∂ÊâáÂΩ¢
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                    ctx.closePath();
                    ctx.fillStyle = prize.color;
                    ctx.fill();

                    // ÁªòÂà∂ËæπÊ°Ü
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 3;
                    ctx.stroke();

                    // ÁªòÂà∂ÊñáÂ≠ó
                    const textAngle = startAngle + angle / 2;
                    const textRadius = radius * 0.7;
                    const textX = centerX + Math.cos(textAngle) * textRadius;
                    const textY = centerY + Math.sin(textAngle) * textRadius;

                    ctx.save();
                    ctx.translate(textX, textY);
                    ctx.rotate(textAngle + Math.PI / 2);
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(prize.name, 0, 0);

                    // ÁªòÂà∂Ê¶ÇÁéá
                    ctx.font = '16px Arial';
                    ctx.fillText(`${((prize.probability / totalProb) * 100).toFixed(1)}%`, 0, 25);
                    ctx.restore();

                    startAngle = endAngle;
                });

                // ÁªòÂà∂Â§ñÂúàË£ÖÈ•∞
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 8;
                ctx.stroke();
            }

            getRandomPrize() {
                const totalProb = this.prizes.reduce((sum, prize) => sum + prize.probability, 0);
                let random = Math.random() * totalProb;

                for (let prize of this.prizes) {
                    random -= prize.probability;
                    if (random <= 0) {
                        return prize;
                    }
                }

                return this.prizes[0];
            }

            spin() {
                if (this.isSpinning) return;

                this.isSpinning = true;
                this.startBtn.disabled = true;
                this.resultDisplay.classList.remove('show');

                // ÈöèÊú∫ÈÄâÊã©‰∏≠Â•ñÂ•ñÂìÅ
                const selectedPrize = this.getRandomPrize();

                // ËÆ°ÁÆóÁõÆÊ†áËßíÂ∫¶
                const totalProb = this.prizes.reduce((sum, prize) => sum + prize.probability, 0);
                let accumulatedProb = 0;
                let targetAngle = 0;

                for (let i = 0; i < this.prizes.length; i++) {
                    if (this.prizes[i] === selectedPrize) {
                        // ÈöèÊú∫ÈÄâÊã©ËØ•ÊâáÂå∫ÂÜÖÁöÑ‰∏Ä‰∏™ËßíÂ∫¶
                        const sectorStartAngle = (accumulatedProb / totalProb) * 360;
                        const sectorAngle = (this.prizes[i].probability / totalProb) * 360;
                        targetAngle = sectorStartAngle + sectorAngle * Math.random();
                        break;
                    }
                    accumulatedProb += this.prizes[i].probability;
                }

                // ËÆ°ÁÆóÊóãËΩ¨ÂúàÊï∞ÂíåÊúÄÁªàËßíÂ∫¶
                const spinRounds = 5; // ÊóãËΩ¨5Âúà
                const totalRotation = spinRounds * 360 + (360 - targetAngle);

                // ÊâßË°åÊóãËΩ¨Âä®Áîª
                this.canvas.style.transform = `rotate(${totalRotation}deg)`;
                this.canvas.style.transition = `transform ${this.duration}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;

                // ÊóãËΩ¨ÁªìÊùüÂêéÊòæÁ§∫ÁªìÊûú
                setTimeout(() => {
                    this.resultDisplay.textContent = `üéâ ÊÅ≠ÂñúËé∑Âæó: ${selectedPrize.name}`;
                    this.resultDisplay.classList.add('show');
                    this.isSpinning = false;
                    this.startBtn.disabled = false;

                    // ÈáçÁΩÆÊóãËΩ¨ËßíÂ∫¶Ôºà‰øùÊåÅËßÜËßâ‰ΩçÁΩÆÔºâ
                    setTimeout(() => {
                        this.canvas.style.transition = 'none';
                        this.canvas.style.transform = `rotate(${totalRotation % 360}deg)`;

                        setTimeout(() => {
                            this.canvas.style.transition = `transform ${this.duration}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;
                        }, 50);
                    }, 500);
                }, this.duration);
            }
        }

        // ÂàùÂßãÂåñÊäΩÂ•ñËΩ¨Áõò
        let lotteryWheel;
        window.addEventListener('DOMContentLoaded', () => {
            lotteryWheel = new LotteryWheel();
        });
    </script>
</body>
</html>
